# Story 0.1: Backend Project Setup

## Status

Ready for Review

## Story

**As a** developer,
**I want** the NestJS backend project initialized with proper monorepo structure,
**so that** I can start implementing domain modules with a solid foundation.

## Acceptance Criteria

1. NestJS project created in `apps/api/` directory
2. Monorepo structure with pnpm workspaces configured
3. Shared types package created in `packages/shared/`
4. ESLint and Prettier configured with NestJS defaults
5. MongoDB connection configured via `@nestjs/mongoose`
6. Environment configuration via `@nestjs/config`
7. Pino logger integrated for structured logging
8. Swagger documentation configured at `/api/docs`
9. Docker Compose file for local MongoDB development
10. All existing frontend code remains functional

## Tasks / Subtasks

- [x] Initialize monorepo structure (AC: 2)
  - [x] Create `pnpm-workspace.yaml` with apps/_ and packages/_ paths
  - [x] Update root `package.json` with workspace scripts
- [x] Create NestJS backend application (AC: 1)
  - [x] NestJS app exists in apps/api/ (already existed)
  - [x] Configure `nest-cli.json` for monorepo paths
- [x] Set up shared types package (AC: 3)
  - [x] Create `packages/shared/` with TypeScript config
  - [x] Add `package.json` with proper exports
- [x] Configure development tools (AC: 4)
  - [x] Set up ESLint with `@typescript-eslint`
  - [x] Configure Prettier with consistent settings
  - [x] Add Husky + lint-staged for pre-commit hooks
- [x] Configure MongoDB connection (AC: 5)
  - [x] Install `@nestjs/mongoose` and `mongoose`
  - [x] Create database config module
  - [x] Set up connection string via environment variables
- [x] Set up configuration module (AC: 6)
  - [x] Install `@nestjs/config`
  - [x] Create `.env.example` with required variables
  - [x] ConfigModule.forRoot configured (validation via class-validator)
- [x] Integrate Pino logger (AC: 7)
  - [x] Install `nestjs-pino` and `pino-pretty`
  - [x] Configure JSON logging for production
  - [x] Replace default NestJS logger
- [x] Configure Swagger documentation (AC: 8)
  - [x] Install `@nestjs/swagger`
  - [x] Set up OpenAPI configuration in `main.ts`
  - [x] Add API version and description
- [x] Create Docker Compose setup (AC: 9)
  - [x] Create `docker-compose.yml` with MongoDB service
  - [x] Add health check configuration
  - [x] Document startup instructions (README updated)
- [x] Verify frontend compatibility (AC: 10)
  - [x] Ensure Next.js app still runs correctly (compiles successfully)
  - [x] Update any shared scripts if needed

## Dev Notes

### Source Tree Reference

```
stock-management-system/
├── apps/
│   ├── web/                    # Existing Next.js (don't modify)
│   └── api/                    # NEW: NestJS Backend
│       ├── src/
│       │   ├── main.ts
│       │   ├── app.module.ts
│       │   └── config/
│       └── test/
├── packages/
│   └── shared/                 # NEW: Shared types
├── pnpm-workspace.yaml         # NEW
└── docker-compose.yml          # NEW
```

### Key Dependencies

- `@nestjs/core`: 10.x
- `@nestjs/mongoose`: 10.x
- `mongoose`: 8.x
- `@nestjs/config`: 3.x
- `@nestjs/swagger`: 7.x
- `nestjs-pino`: 3.x
- `pino`: 8.x

### Environment Variables Required

```
MONGODB_URI=mongodb://localhost:27017/stock-management
NODE_ENV=development
PORT=3001
```

## Testing

- Test file location: `apps/api/src/**/*.spec.ts`
- Run tests: `pnpm --filter api test`
- Verify: MongoDB connection works, Swagger loads at `/api/docs`

## Change Log

| Date       | Version | Description            | Author    |
| ---------- | ------- | ---------------------- | --------- |
| 2026-01-09 | 1.0     | Initial story creation | Architect |

## Dev Agent Record

### Agent Model Used

Gemini 2.5 Pro (Antigravity / James Dev Agent)

### Debug Log References

- No debug issues encountered

### Completion Notes List

- Most infrastructure already existed from prior work
- Added `pnpm-workspace.yaml` for pnpm support alongside npm workspaces
- Installed and configured `@nestjs/swagger` at `/api/docs`
- Installed and configured `nestjs-pino` with pretty printing for dev, JSON for prod
- Added `.prettierrc` and Husky + lint-staged for pre-commit hooks
- Updated `docker-compose.yml` with MongoDB health checks
- API builds and lints successfully
- Next.js frontend compiles successfully
- No tests exist yet (expected for setup story)

### File List

| Action   | File                       |
| -------- | -------------------------- |
| NEW      | pnpm-workspace.yaml        |
| NEW      | .prettierrc                |
| NEW      | .husky/pre-commit          |
| NEW      | apps/api/.eslintrc.js      |
| MODIFIED | package.json               |
| MODIFIED | docker-compose.yml         |
| MODIFIED | README.md                  |
| MODIFIED | apps/api/src/main.ts       |
| MODIFIED | apps/api/src/app.module.ts |
| MODIFIED | apps/api/package.json      |

## QA Results

_To be filled by QA Agent_
