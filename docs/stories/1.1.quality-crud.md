# Story 1.1: Quality CRUD

## Status

Draft

## Story

**As a** factory manager,
**I want** to manage fabric quality types with specifications,
**so that** I can categorize production and stock by product type.

## Acceptance Criteria

1. Quality schema created with name, code, reedPick, width, weight, isActive fields
2. Unique constraint on quality code
3. Text search enabled on quality name
4. GET `/qualities` returns paginated list with optional `isActive` filter
5. POST `/qualities` creates new quality with validation
6. GET `/qualities/:id` returns single quality
7. PUT `/qualities/:id` updates quality
8. DELETE `/qualities/:id` soft-deletes (sets `isActive: false`)
9. All endpoints protected with JwtAuthGuard
10. Swagger documentation complete

## Tasks / Subtasks

- [ ] Create Masters module structure (AC: 9)
  - [ ] Create `modules/masters/masters.module.ts`
  - [ ] Create `modules/masters/quality/` folder
- [ ] Create Quality schema (AC: 1, 2, 3)
  - [ ] Create `quality.schema.ts` with Mongoose decorators
  - [ ] Add unique index on `code`
  - [ ] Add text index on `name`
- [ ] Create DTOs (AC: 5)
  - [ ] Create `create-quality.dto.ts` with validation
  - [ ] Create `update-quality.dto.ts` using PartialType
- [ ] Create Quality service (AC: 4, 5, 6, 7, 8)
  - [ ] Implement `findAll()` with pagination and filters
  - [ ] Implement `findOne()` by ID
  - [ ] Implement `create()` with validation
  - [ ] Implement `update()`
  - [ ] Implement `remove()` as soft delete
- [ ] Create Quality controller (AC: 4-8, 9, 10)
  - [ ] Add all CRUD endpoints
  - [ ] Apply JwtAuthGuard
  - [ ] Add Swagger decorators
- [ ] Write unit tests
  - [ ] Test service methods
  - [ ] Test controller endpoints

## Dev Notes

### Quality Schema

```typescript
{
  _id: ObjectId,
  name: string,           // required, text indexed
  code: string,           // required, unique
  reedPick: string,       // e.g., "60x60"
  width: number,          // inches
  weight: number,         // grams per meter
  isActive: boolean,      // default: true
  createdAt: Date,
  updatedAt: Date
}
```

### API Endpoints

| Method | Endpoint         | Description      |
| ------ | ---------------- | ---------------- |
| GET    | `/qualities`     | List (paginated) |
| POST   | `/qualities`     | Create           |
| GET    | `/qualities/:id` | Get by ID        |
| PUT    | `/qualities/:id` | Update           |
| DELETE | `/qualities/:id` | Soft delete      |

### Pagination Query Params

- `page`: Page number (default: 1)
- `limit`: Items per page (default: 20, max: 100)
- `search`: Text search on name
- `isActive`: Filter by active status

## Testing

- Location: `apps/api/src/modules/masters/quality/*.spec.ts`
- Test CRUD operations
- Test unique code constraint
- Test soft delete sets isActive false
- Test pagination

## Change Log

| Date       | Version | Description            | Author    |
| ---------- | ------- | ---------------------- | --------- |
| 2026-01-09 | 1.0     | Initial story creation | Architect |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_To be filled by QA Agent_
