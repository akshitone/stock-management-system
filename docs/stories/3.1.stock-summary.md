# Story 3.1: Stock Summary

## Status

Draft

## Story

**As a** store manager,
**I want** to view stock by Factory and Quality,
**so that** I can track finished goods inventory levels.

## Acceptance Criteria

1. GET `/stock` returns summary by Factory â†’ Quality
2. GET `/stock/:factoryId/:qualityId` returns detailed stock with taka list
3. Stock aggregated from takas with status 'inStock'
4. Summary includes meters total and taka count (dual UOM)

## Tasks / Subtasks

- [ ] Create Inventory module
- [ ] Create Stock service with aggregation
- [ ] Implement stock summary endpoint
- [ ] Implement detailed stock endpoint
- [ ] Write tests

## Dev Notes

### Stock Summary Response

```typescript
{
  summary: [
    {
      factoryId: string,
      factoryName: string,
      qualities: [
        {
          qualityId: string,
          qualityName: string,
          totalMeters: number,
          totalTakas: number,
        },
      ],
    },
  ];
}
```

### Aggregation Pipeline

- Match takas with status = 'inStock'
- Group by factoryId, qualityId
- Sum meters and count

## Testing

- Test summary aggregates correctly
- Test detailed view returns taka list

## Change Log

| Date       | Version | Description            | Author    |
| ---------- | ------- | ---------------------- | --------- |
| 2026-01-09 | 1.0     | Initial story creation | Architect |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_To be filled by QA Agent_
