# Story 2.3: Bulk Production Entry

## Status

Draft

## Story

**As a** factory supervisor,
**I want** to enter production data in a grid format,
**so that** I can record multiple taka entries efficiently at end of shift.

## Acceptance Criteria

1. Taka schema with takaNo, type, qualityId, factoryId, beamId, meters, count (DUAL UOM), weight, weaverId, status
2. **CRITICAL:** Both meters AND count (takas) are REQUIRED fields - dual UOM enforcement
3. POST `/production/bulk-entry` accepts array of taka entries
4. Each entry validated for dual UOM before processing
5. Taka created with status 'inStock'
6. Event emitted for each taka creation (for inventory module)
7. Beam.actualMeters updated on taka creation
8. Batch response shows success/failure per entry

## Tasks / Subtasks

- [ ] Create Taka schema with dual UOM fields
- [ ] Create DualUomValidator custom pipe
- [ ] Create BulkProductionService
- [ ] Create BulkProductionController
- [ ] Emit TakaCreatedEvent on save
- [ ] Update beam meters on taka creation
- [ ] Write unit tests with dual UOM validation

## Dev Notes

### Taka Schema

```typescript
{
  takaNo: number,         // auto-increment per factory
  type: 'grey' | 'folded' | 'rfd',
  qualityId: ObjectId,
  factoryId: ObjectId,
  beamId: ObjectId,
  meters: number,         // **REQUIRED**
  count: number,          // **REQUIRED** (takas)
  weight: {
    gross: number,
    tare: number,
    net: number
  },
  weaverId: ObjectId,
  status: 'inStock' | 'issued' | 'sold',
  productionDate: Date
}
```

### Bulk Entry Request

```typescript
{
  date: Date,
  entries: [{
    machineId: string,
    beamId: string,
    meters: number,      // REQUIRED
    takas: number,       // REQUIRED
    grossWeight: number,
    tareWeight: number,
    weaverId: string
  }]
}
```

### CRITICAL: Dual UOM Validation

**NEVER** allow taka creation without BOTH meters and count fields.

## Testing

- Test bulk entry creates multiple takas
- Test validation fails without meters OR takas
- Test beam.actualMeters updates
- Test event emission

## Change Log

| Date       | Version | Description            | Author    |
| ---------- | ------- | ---------------------- | --------- |
| 2026-01-09 | 1.0     | Initial story creation | Architect |

## Dev Agent Record

### Agent Model Used

_To be filled by Dev Agent_

### Debug Log References

_To be filled by Dev Agent_

### Completion Notes List

_To be filled by Dev Agent_

### File List

_To be filled by Dev Agent_

## QA Results

_To be filled by QA Agent_
